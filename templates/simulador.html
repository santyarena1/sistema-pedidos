<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Simulador de costos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="{{ url_for('static', filename='css/buscador.css') }}" rel="stylesheet">
</head>
<body>

    <!-- Sidebar igual al del comparador -->
    <div id="sidebar">
        <div class="sidebar-title my-3 text-center">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo TheGamerShop" class="img-fluid" style="max-height: 80px;">
        </div>

        {% set ruta_actual = request.path %}
        {% set es_presupuestos = ruta_actual.startswith('/presupuestos') or ruta_actual.startswith('/pcs_predeterminadas') %}
        {% set es_stock = ruta_actual.startswith('/stock') or ruta_actual.startswith('/componentes-presupuesto') %}
        {% set es_pedidos = ruta_actual.startswith('/pedidos') %}

        <ul class="nav flex-column">
            <li class="nav-item mb-1">
                <a class="nav-link {% if ruta_actual == '/buscar' %}active{% endif %}" href="/buscar">
                    <i class="fas fa-search fa-fw me-2"></i>Comparador
                </a>
            </li>

            <!-- NUEVO: Simulador de costos -->
            <li class="nav-item mb-1">
                <a class="nav-link {% if ruta_actual.startswith('/simulador') %}active{% endif %}" href="/simulador">
                    <i class="fas fa-calculator fa-fw me-2"></i>Cuotas
                </a>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link {% if not es_presupuestos %}collapsed{% endif %}" href="#" data-bs-toggle="collapse" data-bs-target="#presupuestos-menu" aria-expanded="{{ 'true' if es_presupuestos else 'false' }}">
                    <i class="fas fa-file-invoice-dollar fa-fw me-2"></i>Presupuestos
                </a>
                <div class="collapse {% if es_presupuestos %}show{% endif %}" id="presupuestos-menu">
                    <ul class="nav flex-column ms-3">
                        <li class="nav-item"><a class="nav-link {% if ruta_actual == '/presupuestos' %}active{% endif %}" href="/presupuestos"><i class="fas fa-plus fa-fw me-2"></i>Crear presupuesto</a></li>
                        <li class="nav-item"><a class="nav-link {% if ruta_actual == '/pcs_predeterminadas' %}active{% endif %}" href="/pcs_predeterminadas"><i class="fas fa-desktop fa-fw me-2"></i>PCs Predeterminadas</a></li>
                    </ul>
                </div>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link {% if not es_stock %}collapsed{% endif %}" href="#" data-bs-toggle="collapse" data-bs-target="#stock-menu" aria-expanded="{{ 'true' if es_stock else 'false' }}">
                    <i class="fas fa-boxes fa-fw me-2"></i>Stock y componentes
                </a>
                <div class="collapse {% if es_stock %}show{% endif %}" id="stock-menu">
                    <ul class="nav flex-column ms-3">
                        <li class="nav-item"><a class="nav-link {% if ruta_actual == '/stock' %}active{% endif %}" href="/stock"><i class="fas fa-list-alt fa-fw me-2"></i>Lista de stock</a></li>
                        <li class="nav-item"><a class="nav-link {% if ruta_actual == '/componentes-presupuesto' %}active{% endif %}" href="/componentes-presupuesto"><i class="fas fa-cogs fa-fw me-2"></i>Componentes</a></li>
                    </ul>
                </div>
            </li>

            <li class="nav-item mb-1">
                <a class="nav-link {% if not es_pedidos %}collapsed{% endif %}" href="#" data-bs-toggle="collapse" data-bs-target="#pedidos-menu" aria-expanded="{{ 'true' if es_pedidos else 'false' }}">
                    <i class="fas fa-truck fa-fw me-2"></i>Pedidos
                </a>
                <div class="collapse {% if es_pedidos %}show{% endif %}" id="pedidos-menu">
                    <ul class="nav flex-column ms-3">
                        <li class="nav-item"><a class="nav-link {% if ruta_actual == '/pedidos' %}active{% endif %}" href="/pedidos"><i class="fas fa-plus-circle fa-fw me-2"></i>Nuevo pedido</a></li>
                        <li class="nav-item"><a class="nav-link {% if ruta_actual == '/pedidos/lista' %}active{% endif %}" href="/pedidos/lista"><i class="fas fa-list fa-fw me-2"></i>Lista de pedidos</a></li>
                    </ul>
                </div>
            </li>
        </ul>

        <div class="mt-auto p-3 text-white small">
            <i class="fas fa-dollar-sign me-1"></i>Oficial: (Dólar Oficial)<br>
            <i class="fas fa-hand-holding-usd me-1"></i>Blue: (Dólar Blue)
        </div>
    </div>

    <!-- Contenido -->
    <div id="main-content">
        <div class="page-title mb-4">
            <h1 class="mb-1">Simulador de costos</h1>
            <div class="title-underline"></div>
        </div>

        <div class="card-search my-4">
            <div class="card card-body mb-4">
                <h5 class="mb-3">Ingresá el precio base</h5>
                <div class="row g-3 align-items-center">
                    <div class="col-md-6">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text">$</span>
                            <input type="number" id="precioBase" class="form-control" placeholder="0" min="0" step="0.01">
                        </div>
                        <div class="text-muted small mt-2">Se actualiza en tiempo real mientras escribís.</div>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <button class="btn btn-soft-gear" data-bs-toggle="modal" data-bs-target="#modalConfiguracion">
                            <i class="fas fa-cog me-2"></i> Configuración de planes
                        </button>
                    </div>
                </div>
            </div>

            <!-- FILA 1 -->
            <div class="mb-4">
                <div class="row align-items-center mb-2">
                    <div class="col-auto"><span class="badge-pill badge-mp"><i class="fas fa-wallet me-2"></i>Mercado Pago</span></div>
                    <div class="col text-muted small">Débito & Crédito</div>
                </div>
                <div class="row g-3" id="fila-mp-basico"></div>
            </div>

            <!-- FILA 2 -->
            <div class="mb-4">
                <div class="row align-items-center mb-2">
                    <div class="col-auto"><span class="badge-pill badge-mp"><i class="fas fa-wallet me-2"></i>Mercado Pago</span></div>
                    <div class="col text-muted small">Cuotas</div>
                </div>
                <div class="row g-3" id="fila-mp-cuotas"></div>
            </div>

            <!-- FILA 3 -->
            <div class="mb-1">
                <div class="row align-items-center mb-2">
                    <div class="col-auto"><span class="badge-pill badge-bbva"><i class="fas fa-credit-card me-2"></i>BBVA</span></div>
                    <div class="col text-muted small">Crédito / 3 s/interés / 6 s/interés</div>
                </div>
                <div class="row g-3" id="fila-bbva"></div>
            </div>
        </div>
    </div>

    <!-- Modal Configuración -->
    <div class="modal fade" id="modalConfiguracion" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content shadow-lg">
                <div class="modal-header">
                    <h5 class="modal-title">Configuración de porcentajes por plan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="configList"></div>
                    <div class="alert alert-info mt-3">
                        <strong>Tip:</strong> Para cuotas SIN INTERÉS dejá el porcentaje en <strong>0%</strong>.
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button class="btn btn-success" id="btnGuardarConfig">Guardar cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.__SIMULADOR_ENDPOINTS__ = {
            get: "{{ url_for('simulador.simulador_get_config') }}",
            put: "{{ url_for('simulador.simulador_put_config') }}"
        };
    </script>
    <script src="{{ url_for('static', filename='js/simulador.js') }}"></script>
</body>
</html>
